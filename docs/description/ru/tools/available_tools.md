# Техническая документация: `tools/available_tools.py` — Реестр инструментов

## 1. Обзор и архитектурная роль
`tools/available_tools.py` — это **динамический реестр** и "инструкция по применению" для всех инструментов, доступных AI-агенту. Его основная задача — не *выполнение* логики, а **описание (декларация)** функций-инструментов.

Этот модуль выполняет роль **"моста" между мыслью (`Thought`) и действием (`Action`)** в ReAct-архитектуре. Чтобы LLM могла сгенерировать корректное "действие" (вызов инструмента в формате JSON), ей нужно заранее предоставить "меню" доступных инструментов. `available_tools.py` является источником этого "меню".

Он решает две ключевые задачи:
1.  **Для `react_driver`**: Предоставляет функцию `get_tool_descriptions_for_llm()`, которая возвращает машиночитаемый JSON-список всех инструментов. Этот JSON подставляется в системный промпт агента, "обучая" его, какие инструменты существуют и как их вызывать.
2.  **Для `mcp_server`**: Служит неявным **"контрактом"**. Имя каждой функции-инструмента (например, `web_search`) напрямую соответствует эндпоинту (`/tools/web_search`), который должен быть реализован в `mcp_server.py`.

## 2. Реализация: Генерация схемы из докстрингов
Модуль реализует мощный механизм **автоматической генерации JSON-схемы** на основе стандартных Python-докстрингов и аннотаций типов. Это кардинально упрощает процесс добавления новых инструментов.

### 2.1. Функции-заглушки (Function Stubs)
Каждый доступный инструмент представлен в виде **функции-заглушки (stub)**.

```python
def web_search(query: str, max_results: int = 5) -> str:
    """
    Выполняет общий поиск в интернете по заданному запросу.
    Используйте для поиска актуальной информации или фактов.

    :param query: Поисковый запрос.
    :param max_results: Максимальное количество возвращаемых результатов.
    :return: Строка с результатами поиска.
    """
    pass
```

*   **Тело функции**: Намеренно пустое (`pass`). Реальная логика выполнения находится в `mcp_server.py`. Этот файл служит только для описания интерфейса.
*   **Сигнатура функции**: `web_search(query: str, max_results: int = 5)` — это строгий контракт.
    *   **Имя (`web_search`)**: Становится `tool_name` в JSON-схеме.
    *   **Аргументы (`query`, `max_results`)**: Становятся ключами в объекте `parameters` схемы.
    *   **Аннотации типов (`str`, `int`)**: Используются для определения типа параметра в JSON-схеме (`string`, `integer`).
    *   **Значения по умолчанию (`= 5`)**: Используются для определения, является ли параметр обязательным.
*   **Докстринг**: Это источник текстовых описаний для LLM. Он имеет строгий формат:
    *   **Первая часть (до `:param`)**: Становится общим `description` инструмента. Это самое важное поле, которое помогает LLM выбрать правильный инструмент.
    *   **Секции `:param имя: описание`**: Используются для генерации описаний каждого параметра в JSON-схеме.

### 2.2. Автоматический генератор схемы (`get_tool_descriptions_for_llm`)
Это "магическая" часть модуля. Функция использует стандартные библиотеки Python `inspect` и `typing` для **интроспекции (самоанализа)** функций-заглушек.

**Алгоритм работы:**
1.  Получает список функций-заглушек.
2.  Итерирует по каждой функции и с помощью интроспекции читает ее имя, докстринг, параметры, аннотации типов и значения по умолчанию.
3.  На основе всей этой информации **динамически конструирует JSON-объект**, соответствующий формату, который понимают современные LLM (например, OpenAI Functions/Tools).

## 3. Руководство: Добавление нового инструмента
Модуль спроектирован так, чтобы добавление новых инструментов было максимально простым.

**Шаг 1: Опишите инструмент как функцию-заглушку**

Создайте новую функцию в `available_tools.py`, следуя формату. Например, для калькулятора:

```python
def calculator(expression: str) -> float:
    """
    Вычисляет математическое выражение.
    Используйте для любых математических расчетов.

    :param expression: Математическое выражение в виде строки (например, "2+2*5").
    :return: Число с плавающей точкой, являющееся результатом вычисления.
    """
    pass
```

**Шаг 2: Зарегистрируйте функцию в списке**

Добавьте имя новой функции в `tools_list` внутри функции `get_tool_descriptions_for_llm`.

```python
def get_tool_descriptions_for_llm():
    tools_list = [web_search, calculator] # <--- Добавили сюда
    # ... остальной код без изменений
```

**Шаг 3: Реализуйте эндпоинт в `mcp_server.py`**

Не забудьте создать соответствующий эндпоинт `/tools/calculator` в `mcp_server.py`, который будет выполнять реальную логику вычисления. (См. документацию по `mcp_server.py` для деталей).

**Готово!** При следующем запуске `react_driver` вызовет `get_tool_descriptions_for_llm()`, который автоматически сгенерирует JSON-схему для нового инструмента "calculator" и включит ее в системный промпт. LLM сразу же "узнает" о новой возможности.